
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Kink Artist Explorer</title>
  <style>
    body {
      font-family: sans-serif;
      color: #eee;
      margin: 0;
      padding: 0;
      background-color: #000;
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      background-attachment: fixed;
      transition: background-image 1s ease-in-out;
    }
    h1 {
      background: linear-gradient(to right, #ff66cc, #aa88ff);
      margin: 0;
      padding: 1rem;
      text-align: center;
      color: white;
      font-weight: bold;
    }
    .button-grid {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      margin: 1rem;
      gap: 0.5rem;
    }
    .filter-btn {
      padding: 0.5rem 1rem;
      background: #333;
      color: white;
      border: 1px solid #888;
      border-radius: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .filter-btn:hover {
      background: #ff66cc;
      color: #000;
    }
    .highlighted {
      background: #ff66cc !important;
      color: black !important;
      font-weight: bold;
    }
    .table-container { overflow-x: auto; max-width: 100vw; }
    table { border-collapse: collapse; width: 100%; font-size: 0.8rem; background-color: rgba(0,0,0,0.7); }
    th, td { border: 1px solid #333; padding: 0.3rem; text-align: center; }
    th { position: sticky; top: 0; background: #2a2a2a; color: #ffb6ff; }
    td.true { background: #ff66cc; color: black; font-weight: bold; }
    td.false { background: #1e1e1e; color: #666; }
    tr:hover { background-color: #333; }
    img.preview {
      width: 64px;
      height: auto;
      border-radius: 6px;
      border: 1px solid #555;
      transition: transform 0.3s ease;
    }
    img.preview:hover {
      transform: scale(2.5);
      z-index: 10;
      position: relative;
    }
  </style>
</head>
<body>
  <h1>Kink Artist Explorer</h1>
  <div class="button-grid" id="filterGrid"></div>
  <div class="table-container">
    <table id="kink-table"></table>
  </div>

<script>
let csvURL = 'data.csv', kinkData = [], headers = [];

async function updateBackground(tag) {
  const url = `https://danbooru.donmai.us/posts.json?tags=${encodeURIComponent(tag)}+rating:explicit+-loli+-shota+-young&random=true&limit=1`;
  try {
    const response = await fetch(url);
    const posts = await response.json();
    if (posts.length > 0 && posts[0].large_file_url) {
      const imgUrl = "https://danbooru.donmai.us" + posts[0].large_file_url;
      document.body.style.backgroundImage = `url('${imgUrl}')`;
    }
  } catch (error) {
    console.error("Failed to fetch Danbooru background:", error);
  }
}

function loadCSV(url) {
  fetch(url)
    .then(r => r.text())
    .then(text => {
      let rows = text.trim().split("\n").map(r => r.split(","));
      headers = rows[0];
      kinkData = rows.slice(1);
      populateButtons();
      buildTable([]);
    });
}

function populateButtons() {
  const grid = document.getElementById("filterGrid");
  headers.slice(6).forEach(k => {
    let btn = document.createElement("button");
    btn.textContent = k;
    btn.className = "filter-btn";
    btn.onclick = () => toggleKink(btn, k);
    grid.appendChild(btn);
  });
}

let selectedKinks = [];

function toggleKink(btn, kink) {
  if (selectedKinks.includes(kink)) {
    selectedKinks = selectedKinks.filter(k => k !== kink);
    btn.classList.remove("highlighted");
  } else {
    selectedKinks.push(kink);
    btn.classList.add("highlighted");
    updateBackground(kink);
  }
  buildTable(selectedKinks);
}

function buildTable(kinks) {
  let table = document.getElementById("kink-table");
  table.innerHTML = "";

  let thead = document.createElement("thead");
  let headerRow = document.createElement("tr");
  headers.forEach(h => {
    let th = document.createElement("th");
    th.textContent = h;
    headerRow.appendChild(th);
  });
  thead.appendChild(headerRow);
  table.appendChild(thead);

  let tbody = document.createElement("tbody");
  kinkData.forEach(row => {
    let matches = kinks.every(k => row[headers.indexOf(k)] === '1');
    if (kinks.length === 0 || matches) {
      let tr = document.createElement("tr");
      row.forEach((val, i) => {
        let td = document.createElement("td");
        if (headers[i] === "Image URL") {
          let img = document.createElement("img");
          img.src = val;
          img.className = "preview";
          td.appendChild(img);
        } else {
          td.textContent = val;
          if (i >= 6) {
            td.className = val === '1' ? 'true' : 'false';
            if (kinks.includes(headers[i]) && val === '1') {
              td.classList.add('highlighted');
            }
          }
        }
        tr.appendChild(td);
      });
      tbody.appendChild(tr);
    }
  });
  table.appendChild(tbody);
}

loadCSV(csvURL);
</script>
</body>
</html>
